
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Tutorials for analysing bacterial omics data">
      
      
        <meta name="author" content="Anna Syme, Torsten Seemann">
      
      
        <link rel="canonical" href="http://sepsis-omics.github.io/tutorials/modules/cmdline_assembly_v2/">
      
      
        <link rel="prev" href="../roary-galaxy/">
      
      
        <link rel="next" href="../dge/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.0, mkdocs-material-9.5.26">
    
    
      
        <title>Long read assembly workshop - ABRPI-Training</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.6543a935.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../css/sepsis.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#long-read-assembly-workshop" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="ABRPI-Training" class="md-header__button md-logo" aria-label="ABRPI-Training" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            ABRPI-Training
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Long read assembly workshop
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/sepsis-omics/tutorials" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    sepsis-omics/tutorials
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="ABRPI-Training" class="md-nav__button md-logo" aria-label="ABRPI-Training" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    ABRPI-Training
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/sepsis-omics/tutorials" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    sepsis-omics/tutorials
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Genomics
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Genomics
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../workshop_overview/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Genomics workshop overview
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../galaxy/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Starting with Galaxy
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../data-dna/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Training dataset
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../fastqc/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Quality control
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../pear/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Merge reads with Pear
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../velvet/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Genome assembly with Velvet
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../spades/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Genome assembly with Spades
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../prokka/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Genome annotation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../snippy/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Variant finding
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../access_data/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Public data &rarr; assembly, annotation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../abricate/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Finding antibiotic-resistant genes
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../viral_genomes/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Viral genome sequencing
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../workflows/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Galaxy workflows
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../frogs/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Metagenomics with FROGS
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../kraken/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Sample identification with Kraken
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../pacbio/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    PacBio assembly with SMRT portal
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../cmdline_assembly/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    PacBio assembly with command line tools
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../spades_cmdline/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Spades assembly - commandline
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../mauve/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Genome alignment with Mauve
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../roary/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Pangenomes with Roary/Phandango - command line
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../roary-galaxy/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Pangenomes with Roary/Phandango - Galaxy
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Long read assembly workshop
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Long read assembly workshop
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    <span class="md-ellipsis">
      Overview
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#1-get-started" class="md-nav__link">
    <span class="md-ellipsis">
      1. Get started
    </span>
  </a>
  
    <nav class="md-nav" aria-label="1. Get started">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mac-users" class="md-nav__link">
    <span class="md-ellipsis">
      Mac users
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#windows-users" class="md-nav__link">
    <span class="md-ellipsis">
      Windows users
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-a-new-working-directory-on-your-remote-computer" class="md-nav__link">
    <span class="md-ellipsis">
      Create a new working directory on your remote computer.
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-get-data" class="md-nav__link">
    <span class="md-ellipsis">
      2. Get data
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-assemble" class="md-nav__link">
    <span class="md-ellipsis">
      3. Assemble
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-check-assembly-output" class="md-nav__link">
    <span class="md-ellipsis">
      4. Check assembly output
    </span>
  </a>
  
    <nav class="md-nav" aria-label="4. Check assembly output">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#questions" class="md-nav__link">
    <span class="md-ellipsis">
      Questions
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5-trim-and-circularise" class="md-nav__link">
    <span class="md-ellipsis">
      5. Trim and circularise
    </span>
  </a>
  
    <nav class="md-nav" aria-label="5. Trim and circularise">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#run-circlator" class="md-nav__link">
    <span class="md-ellipsis">
      Run Circlator
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#check-the-output" class="md-nav__link">
    <span class="md-ellipsis">
      Check the output
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#questions_1" class="md-nav__link">
    <span class="md-ellipsis">
      Questions
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#6-find-smaller-plasmids" class="md-nav__link">
    <span class="md-ellipsis">
      6. Find smaller plasmids
    </span>
  </a>
  
    <nav class="md-nav" aria-label="6. Find smaller plasmids">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#align-illumina-reads-to-the-pacbio-contig" class="md-nav__link">
    <span class="md-ellipsis">
      Align Illumina reads to the PacBio contig
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#extract-unmapped-illumina-reads" class="md-nav__link">
    <span class="md-ellipsis">
      Extract unmapped Illumina reads
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#assemble-the-unmapped-reads" class="md-nav__link">
    <span class="md-ellipsis">
      Assemble the unmapped reads
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#trim-the-plasmid" class="md-nav__link">
    <span class="md-ellipsis">
      Trim the plasmid
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#collect-contigs" class="md-nav__link">
    <span class="md-ellipsis">
      Collect contigs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#questions_2" class="md-nav__link">
    <span class="md-ellipsis">
      Questions
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#7-correct-the-assembly" class="md-nav__link">
    <span class="md-ellipsis">
      7. Correct the assembly
    </span>
  </a>
  
    <nav class="md-nav" aria-label="7. Correct the assembly">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#make-an-alignment-file" class="md-nav__link">
    <span class="md-ellipsis">
      Make an alignment file
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#run-pilon" class="md-nav__link">
    <span class="md-ellipsis">
      Run Pilon
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#questions_3" class="md-nav__link">
    <span class="md-ellipsis">
      Questions
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#8-comparative-genomics" class="md-nav__link">
    <span class="md-ellipsis">
      8. Comparative Genomics
    </span>
  </a>
  
    <nav class="md-nav" aria-label="8. Comparative Genomics">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#assemblies" class="md-nav__link">
    <span class="md-ellipsis">
      Assemblies
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#annotations" class="md-nav__link">
    <span class="md-ellipsis">
      Annotations
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#9-summary" class="md-nav__link">
    <span class="md-ellipsis">
      9. Summary
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Transcriptomics
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Transcriptomics
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../dge/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Differential gene expression using Galaxy and Degust
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../kallisto/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Differential gene expression using Kallisto and Degust
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Proteomics
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Proteomics
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../xtandem/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Protein Identification
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../pathway_tools/annotation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Pathway annotation and prediction
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Metabolomics
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Metabolomics
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../xcms/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Metabolite identification
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../about/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    About
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    <span class="md-ellipsis">
      Overview
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#1-get-started" class="md-nav__link">
    <span class="md-ellipsis">
      1. Get started
    </span>
  </a>
  
    <nav class="md-nav" aria-label="1. Get started">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mac-users" class="md-nav__link">
    <span class="md-ellipsis">
      Mac users
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#windows-users" class="md-nav__link">
    <span class="md-ellipsis">
      Windows users
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-a-new-working-directory-on-your-remote-computer" class="md-nav__link">
    <span class="md-ellipsis">
      Create a new working directory on your remote computer.
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-get-data" class="md-nav__link">
    <span class="md-ellipsis">
      2. Get data
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-assemble" class="md-nav__link">
    <span class="md-ellipsis">
      3. Assemble
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-check-assembly-output" class="md-nav__link">
    <span class="md-ellipsis">
      4. Check assembly output
    </span>
  </a>
  
    <nav class="md-nav" aria-label="4. Check assembly output">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#questions" class="md-nav__link">
    <span class="md-ellipsis">
      Questions
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5-trim-and-circularise" class="md-nav__link">
    <span class="md-ellipsis">
      5. Trim and circularise
    </span>
  </a>
  
    <nav class="md-nav" aria-label="5. Trim and circularise">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#run-circlator" class="md-nav__link">
    <span class="md-ellipsis">
      Run Circlator
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#check-the-output" class="md-nav__link">
    <span class="md-ellipsis">
      Check the output
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#questions_1" class="md-nav__link">
    <span class="md-ellipsis">
      Questions
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#6-find-smaller-plasmids" class="md-nav__link">
    <span class="md-ellipsis">
      6. Find smaller plasmids
    </span>
  </a>
  
    <nav class="md-nav" aria-label="6. Find smaller plasmids">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#align-illumina-reads-to-the-pacbio-contig" class="md-nav__link">
    <span class="md-ellipsis">
      Align Illumina reads to the PacBio contig
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#extract-unmapped-illumina-reads" class="md-nav__link">
    <span class="md-ellipsis">
      Extract unmapped Illumina reads
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#assemble-the-unmapped-reads" class="md-nav__link">
    <span class="md-ellipsis">
      Assemble the unmapped reads
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#trim-the-plasmid" class="md-nav__link">
    <span class="md-ellipsis">
      Trim the plasmid
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#collect-contigs" class="md-nav__link">
    <span class="md-ellipsis">
      Collect contigs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#questions_2" class="md-nav__link">
    <span class="md-ellipsis">
      Questions
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#7-correct-the-assembly" class="md-nav__link">
    <span class="md-ellipsis">
      7. Correct the assembly
    </span>
  </a>
  
    <nav class="md-nav" aria-label="7. Correct the assembly">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#make-an-alignment-file" class="md-nav__link">
    <span class="md-ellipsis">
      Make an alignment file
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#run-pilon" class="md-nav__link">
    <span class="md-ellipsis">
      Run Pilon
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#questions_3" class="md-nav__link">
    <span class="md-ellipsis">
      Questions
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#8-comparative-genomics" class="md-nav__link">
    <span class="md-ellipsis">
      8. Comparative Genomics
    </span>
  </a>
  
    <nav class="md-nav" aria-label="8. Comparative Genomics">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#assemblies" class="md-nav__link">
    <span class="md-ellipsis">
      Assemblies
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#annotations" class="md-nav__link">
    <span class="md-ellipsis">
      Annotations
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#9-summary" class="md-nav__link">
    <span class="md-ellipsis">
      9. Summary
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="long-read-assembly-workshop">Long read assembly workshop</h1>
<p>This is a tutorial for a workshop on long-read (PacBio) genome assembly. </p>
<p>It demonstrates how to use long PacBio sequencing reads to assemble a bacterial genome, and includes additional steps for circularising, trimming, finding plasmids, and correcting the assembly with short-read Illumina data. </p>
<h2 id="overview">Overview</h2>
<p>Simplified version of workflow:</p>
<p><img alt="workflow" src="images/flowchart.png" /></p>
<h2 id="1-get-started">1. Get started</h2>
<p>Your workshop trainers will provide you with the address of a virtual machine. </p>
<h3 id="mac-users">Mac users</h3>
<p>Open the Terminal. </p>
<ul>
<li>Type in </li>
</ul>
<div class="codehilite"><pre><span></span><code><span class="nx">ssh</span><span class="w"> </span><span class="nx">researcher</span><span class="err">@</span><span class="p">[</span><span class="nx">your</span><span class="w"> </span><span class="kd">virtual</span><span class="w"> </span><span class="nx">machine</span><span class="w"> </span><span class="nx">address</span><span class="p">]</span>
</code></pre></div>

<ul>
<li>Type in the password provided. </li>
</ul>
<h3 id="windows-users">Windows users</h3>
<p>If you are using Windows 10, you might be able to use the Ubuntu Subsystem. Otherwise, install and open Putty. </p>
<ul>
<li>Download putty <a href="http://www.chiark.greenend.org.uk/~sgtatham/putty/download.html">here</a>.</li>
<li>Open. A configuration window will appear. </li>
<li>Under &ldquo;Host Name (or IP address)&rdquo; enter in the address of your virtual machine. </li>
<li>Under &ldquo;Port&rdquo; type in 22</li>
<li>Under &ldquo;Connection Type&rdquo; select &ldquo;SSH&rdquo;</li>
<li>Click &ldquo;Open&rdquo;</li>
<li>Under &ldquo;Login as:&rdquo; enter &ldquo;researcher&rdquo;</li>
<li>Type in the password provided. </li>
</ul>
<h3 id="create-a-new-working-directory-on-your-remote-computer">Create a new working directory on your remote computer.</h3>
<p>Because we are starting a new analysis it is always good practice to start in a new empty directory. Therefore, we will create a new directory and change to it for the rest of the workshop.</p>
<p>In your terminal:</p>
<ul>
<li>Create a new directory called &ldquo;Workshop&rdquo;</li>
</ul>
<div class="codehilite"><pre><span></span><code>mkdir Workshop
</code></pre></div>

<ul>
<li>Change to that directory</li>
</ul>
<div class="codehilite"><pre><span></span><code>cd Workshop
</code></pre></div>

<p><strong>NOTE: Everytime you open a new terminal or Putty session, you will need to make sure you are in this directory again.</strong></p>
<p>The current directory can be obtained with the linux command:</p>
<div class="codehilite"><pre><span></span><code>pwd
</code></pre></div>

<h2 id="2-get-data">2. Get data</h2>
<p>The sample used in this tutorial is from a bacteria called <em>Staphylococcus aureus</em>. We have used a small section of its real genome so that the programs can run in the workshop time. </p>
<p>The files we need are:</p>
<ul>
<li><fn>pacbio.fq</fn>: the PacBio reads</li>
<li><fn>R1.fq</fn>: the Illumina forward reads</li>
<li><fn>R2.fq</fn>: the Illumina reverse reads</li>
</ul>
<p>In a new tab, go to <a href="https://doi.org/10.5281/zenodo.1009308">https://doi.org/10.5281/zenodo.1009308</a>. </p>
<ul>
<li>Next to the first file, right-click (or control-click) the &ldquo;Download&rdquo; button, and select &ldquo;Copy link address&rdquo;.</li>
<li>Back in your terminal, enter </li>
</ul>
<div class="codehilite"><pre><span></span><code>wget [paste file link here]
</code></pre></div>

<ul>
<li>The file should download. </li>
<li><em>Note:</em> paste the link to the file, not to the webpage.</li>
<li>Repeat this for the other two files. </li>
</ul>
<h2 id="3-assemble">3. Assemble<a name="assemble"></a></h2>
<p>We will use the assembly software called <a href="http://canu.readthedocs.io/en/stable/">Canu</a>, version 1.6.</p>
<p>Run Canu with these commands:</p>
<div class="codehilite"><pre><span></span><code>canu -p canu -d canu_outdir genomeSize=0.03m -pacbio-raw pacbio.fq
</code></pre></div>

<ul>
<li>the first <code>canu</code> tells the program to run</li>
<li><code>-p canu</code> names prefix for output files (&ldquo;canu&rdquo;)</li>
<li><code>-d canu_outdir</code> names output directory (&ldquo;canu_outdir&rdquo;)</li>
<li><code>genomeSize</code> only has to be approximate. (In this case we are using a partial genome of expected size 30,000 base pairs). </li>
<li>Canu will correct, trim and assemble the reads.</li>
<li>Various output will be displayed on the screen.</li>
<li><em>Note</em>: Canu could say &ldquo;Finished&rdquo; but may still be running. In this case, type <code>squeue</code> to see if jobs are still running. </li>
</ul>
<p>If you run <code>squeue</code> you will see something like this:</p>
<div class="codehilite"><pre><span></span><code>             JOBID PARTITION     NAME     USER ST       TIME  NODES NODELIST(REASON)
                 6      main canu_can research PD       0:00      1 (Dependency)
               5_1      main cormhap_ research  R       0:29      1 master
</code></pre></div>

<p>You will know if <strong>Canu</strong> has completely finished when <code>squeue</code> shows no jobs listed under the header row. </p>
<h2 id="4-check-assembly-output">4. Check assembly output</h2>
<p>Move into the canu output folder: </p>
<div class="codehilite"><pre><span></span><code>cd canu_outdir
</code></pre></div>

<p>View the list of files: </p>
<div class="codehilite"><pre><span></span><code>ls
</code></pre></div>

<ul>
<li>The <fn>canu.contigs.fasta</fn> are the assembled sequences.</li>
<li>The <fn>canu.unassembled.fasta</fn> are the reads that could not be assembled.</li>
<li>The <fn>canu.correctedReads.fasta.gz</fn> are the corrected Pacbio reads that were used in the assembly.</li>
<li>The <fn>canu.contigs.gfa</fn> is the graph of the assembly.</li>
<li>The <fn>canu.report</fn> file is a summary of all of the steps Canu performed with information about the reads used, how they were handled and a whole lot of summary information about the assembly.</li>
</ul>
<p>Display summary information about the contigs: (<code>infoseq</code> is a tool from <a href="http://emboss.sourceforge.net/index.html">EMBOSS</a>)</p>
<div class="codehilite"><pre><span></span><code>infoseq canu.contigs.fasta
</code></pre></div>

<ul>
<li>This will show the contigs found by Canu. e.g.,  tig00000001  39136</li>
<li>&ldquo;tig00000001&rdquo; is the name given to the contig</li>
<li>&ldquo;39136&rdquo; is the number of base pairs in that contig.</li>
</ul>
<p>This matches what we were expecting for this sample (approximately 30,000 base pairs). For other data, Canu may not be able to join all the reads into one contig, so there may be several contigs in the output.</p>
<p>We should also look at the <fn>canu.report</fn>. To do this:</p>
<div class="codehilite"><pre><span></span><code>less canu.report
</code></pre></div>

<ul>
<li>&ldquo;less&rdquo; is a command to display the file on the screen.</li>
<li>Use the up and down arrows to scroll up and down. </li>
<li>You will see lots of histograms of read lengths before and after processing, final contig construction, etc. </li>
<li>For a description of the outputs that Canu produces, see: <a href="http://canu.readthedocs.io/en/latest/tutorial.html#outputs">http://canu.readthedocs.io/en/latest/tutorial.html#outputs</a></li>
<li>Type <code>q</code> to exit viewing the report. </li>
</ul>
<h3 id="questions">Questions</h3>
<div class="admonition note">
<p class="admonition-title">Question</p>
<p>How do long- and short-read assembly methods differ?</p>
<details>
<summary>Answer</summary>
<p>Short reads are usually assembled with De Bruijn graphs. For long reads, there is a move back towards simpler overlap-layout-consensus methods.</p>
</details>
</div>
<div class="admonition note">
<p class="admonition-title">Question</p>
<p>Where can we find out the what the approximate genome size should be for the species being assembled?</p>
<details>
<summary>Answer</summary>
<p>Go to NCBI Genomes, enter species name, click on Genome Assembly and Annotation report, sort table by clicking on the column header Size (Mb), look at range of sizes in this column.</p>
</details>
</div>
<div class="admonition note">
<p class="admonition-title">Question</p>
<p>In the assembly output, what are the unassembled reads? Why are they there?</p>
<details>
<summary>Answer</summary>
<p>Reads and low-coverage contigs that were not used in the assembly. </p>
</details>
</div>
<div class="admonition note">
<p class="admonition-title">Question</p>
<p>What are the corrected reads? How did canu correct the reads?</p>
<details>
<summary>Answer</summary>
<p>Canu builds overlaps between reads. The consensus is used to correct the reads. </p>
</details>
</div>
<div class="admonition note">
<p class="admonition-title">Question</p>
<p>Where could you view the output .gfa and what would it show?</p>
<details>
<summary>Answer</summary>
<p>A useful program is <a href="https://rrwick.github.io/Bandage/">Bandage</a>. If the assembly has multiple contigs, the assembly graph shows how these are connected. </p>
</details>
</div>
<h2 id="5-trim-and-circularise">5. Trim and circularise</h2>
<p>Bacteria have circular chromosomes. </p>
<ul>
<li>Because of sequencing errors, there may be some &ldquo;overhang&rdquo; in the assembled linear sequence. </li>
<li>Our assembly may have some overhang because it is 9000 bases longer than expected. </li>
</ul>
<p><img alt="circlator" src="images/circlator_diagram.png" />
<em>Adapted from Figure 1. Hunt et al. Genome Biology 2015</em></p>
<p>A tool called <a href="http://sanger-pathogens.github.io/circlator/">Circlator</a> identifies and trims overhangs (on chromosomes and plasmids). It takes in the assembled contigs from Canu, as well as the corrected reads prepared by Canu.</p>
<p>Move back into your main analysis folder: </p>
<div class="codehilite"><pre><span></span><code>cd ..
</code></pre></div>

<h3 id="run-circlator">Run Circlator</h3>
<div class="codehilite"><pre><span></span><code>circlator all --threads 4 --verbose canu_outdir/canu.contigs.fasta canu_outdir/canu.correctedReads.fasta.gz circlator_outdir
</code></pre></div>

<ul>
<li>
<p>(Click on the dark grey slider bar above and move it to the right, to see all the way to the end of the line.)</p>
</li>
<li>
<p><code>--threads</code> is the number of cores</p>
</li>
<li><code>--verbose</code> prints progress information to the screen</li>
<li><code>canu_outdir/canu.contigs.fasta</code> is the file path to the input Canu assembly</li>
<li><code>canu_outdir/canu.correctedReads.fasta.gz</code> is the file path to the corrected Pacbio reads - note, fastA not fastQ</li>
<li><code>circlator_outdir</code> is the name of the output directory.</li>
</ul>
<p>Some output will print to screen. When finished, it should say &ldquo;Circularized x of x contig(s)&rdquo;.</p>
<h3 id="check-the-output">Check the output</h3>
<p>Move into the Circlator output directory: </p>
<div class="codehilite"><pre><span></span><code>cd circlator_outdir
</code></pre></div>

<p>List the files: </p>
<div class="codehilite"><pre><span></span><code>ls
</code></pre></div>

<p>Circlator has named the output files with numbers as prefixes. </p>
<p>Were the contigs circularised?</p>
<div class="codehilite"><pre><span></span><code>less 04.merge.circularise.log
</code></pre></div>

<ul>
<li>&ldquo;less&rdquo; is a command to display the file on the screen.</li>
<li><fn>04.merge.circularise.log</fn> is the name of the file. </li>
<li>Yes, the contig was circularised (last column).</li>
<li>Type <code>q</code> to exit.</li>
</ul>
<p>What are the trimmed contig sizes? </p>
<div class="codehilite"><pre><span></span><code>infoseq 06.fixstart.fasta
</code></pre></div>

<ul>
<li>The contig &ldquo;tig00000001&rdquo; has a length of 30019.</li>
<li>This is about 9000 bases shorter than before circularisation. This was the &ldquo;overhang&rdquo; and has now been trimmed. </li>
</ul>
<p>Copy the circularised contigs file to the main analysis directory with a new name:</p>
<div class="codehilite"><pre><span></span><code>cp 06.fixstart.fasta ../contig1.fasta
</code></pre></div>

<p>Move back into the main folder: </p>
<div class="codehilite"><pre><span></span><code>cd ..
</code></pre></div>

<h3 id="questions_1">Questions</h3>
<div class="admonition note">
<p class="admonition-title">Question</p>
<p>Were all the contigs circularised? </p>
<details>
<summary>Answer</summary>
<p>In this example, yes, the contig was circularised. </p>
</details>
</div>
<div class="admonition note">
<p class="admonition-title">Question</p>
<p>Circlator can set the start of the sequence at a particular gene. Which gene does it use? Is this appropriate for all contigs?</p>
<details>
<summary>Answer</summary>
<p>Circlator uses dnaA (if present) for the chromosomal contig. For other contigs, it uses a centrally-located gene. However, ideally, plasmids would be oriented on a gene such as repA. It is possible to provide a file to Circlator to do this.</p>
</details>
</div>
<h2 id="6-find-smaller-plasmids">6. Find smaller plasmids</h2>
<p>Pacbio reads are long, and may have been longer than small plasmids. We will look for any small plasmids using the Illumina reads.</p>
<p>This section involves several steps:</p>
<ol>
<li>Use the Canu+Circlator output of a trimmed assembly contig.</li>
<li>Map all the Illumina reads against this Pacbio-assembled contig.</li>
<li>Extract any reads that <em>didn&rsquo;t</em> map and assemble them together: this could be a plasmid, or part of a plasmid.</li>
<li>Look for overhang: if found, trim.</li>
</ol>
<h3 id="align-illumina-reads-to-the-pacbio-contig">Align Illumina reads to the PacBio contig</h3>
<p>Index the contigs file:</p>
<div class="codehilite"><pre><span></span><code>bwa index contig1.fasta
</code></pre></div>

<p>Align Illumina reads using using bwa mem:</p>
<div class="codehilite"><pre><span></span><code>bwa mem -t 4 contig1.fasta R1.fq R2.fq | samtools sort &gt; aln.bam
</code></pre></div>

<ul>
<li><code>bwa mem</code> is the alignment tool</li>
<li><code>-t 4</code> is the number of cores</li>
<li><code>contig1.fasta</code> is the input assembly file</li>
<li><code>R1.fq R2.fq</code> are the Illumina reads</li>
<li><code>| samtools sort</code> pipes the output to samtools to sort</li>
<li><code>&gt; aln.bam</code> sends the alignment to the file <fn>aln.bam</fn></li>
</ul>
<h3 id="extract-unmapped-illumina-reads">Extract unmapped Illumina reads</h3>
<p>Index the alignment file:</p>
<div class="codehilite"><pre><span></span><code>samtools index aln.bam
</code></pre></div>

<p>Extract the fastq files from the bam alignment - those reads that were unmapped to the Pacbio alignment - and save them in various &ldquo;unmapped&rdquo; files:</p>
<div class="codehilite"><pre><span></span><code>samtools fastq -f 4 -1 unmapped.R1.fastq -2 unmapped.R2.fastq -s unmapped.RS.fastq aln.bam
</code></pre></div>

<ul>
<li><code>fastq</code> is a command that coverts a <fn>.bam</fn> file into fastq format</li>
<li><code>-f 4</code> : only output unmapped reads</li>
<li><code>-1</code> : put R1 reads into a file called <fn>unmapped.R1.fastq</fn></li>
<li><code>-2</code> : put R2 reads into a file called <fn>unmapped.R2.fastq</fn></li>
<li><code>-s</code> : put singleton reads into a file called <fn>unmapped.RS.fastq</fn></li>
<li><code>aln.bam</code> : input alignment file</li>
</ul>
<p>We now have three files of the unampped reads: <fn> unmapped.R1.fastq</fn>, <fn> unmapped.R2.fastq</fn>, <fn> unmapped.RS.fastq</fn>.</p>
<h3 id="assemble-the-unmapped-reads">Assemble the unmapped reads</h3>
<p>Assemble with Spades:</p>
<div class="codehilite"><pre><span></span><code>spades.py -1 unmapped.R1.fastq -2 unmapped.R2.fastq -s unmapped.RS.fastq --careful --cov-cutoff auto -o spades_assembly
</code></pre></div>

<ul>
<li>
<p>(Click on the dark grey slider bar above and move it to the right, to see all the way to the end of the line.)</p>
</li>
<li>
<p><code>-1</code> is input file forward</p>
</li>
<li><code>-2</code> is input file reverse</li>
<li><code>-s</code> is unpaired</li>
<li><code>--careful</code> minimizes mismatches and short indels</li>
<li><code>--cov-cutoff auto</code> computes the coverage threshold (rather than the default setting, &ldquo;off&rdquo;)</li>
<li><code>-o</code> is the output directory</li>
</ul>
<p>Move into the output directory: </p>
<div class="codehilite"><pre><span></span><code>cd spades_assembly
</code></pre></div>

<p>Look at the contigs: </p>
<div class="codehilite"><pre><span></span><code>infoseq contigs.fasta
</code></pre></div>

<ul>
<li>1 contig has been assembled with a length of 2359 bases. </li>
</ul>
<p>Copy it to a new file: </p>
<div class="codehilite"><pre><span></span><code>cp contigs.fasta contig2.fasta
</code></pre></div>

<h3 id="trim-the-plasmid">Trim the plasmid</h3>
<p>To trim any overhang on this plasmid, we will blast the start of contig2 against itself.</p>
<p>Take the start of the contig: </p>
<div class="codehilite"><pre><span></span><code>head -n 10 contig2.fasta &gt; contig2.fa.head
</code></pre></div>

<ul>
<li><code>head -n 10</code> takes the first ten lines of <fn>contig2.fasta</fn></li>
<li>
<p><code>&gt;</code> sends that output to a new file called <fn>contig2.fa.head</fn></p>
</li>
<li>
<p>We want to see if the start of the contig matches the end (overhang).</p>
</li>
</ul>
<p>Format the assembly file for blast: </p>
<div class="codehilite"><pre><span></span><code><span class="nx">makeblastdb</span><span class="w"> </span><span class="o">-</span><span class="k">in</span><span class="w"> </span><span class="nx">contig2</span><span class="p">.</span><span class="nx">fasta</span><span class="w"> </span><span class="o">-</span><span class="nx">dbtype</span><span class="w"> </span><span class="nx">nucl</span>
</code></pre></div>

<ul>
<li><code>makeblastdb</code> makes a database for the tool Blast</li>
<li>This will generate three new files in the directory with suffixes .nhr, .nin and .nsq</li>
<li><code>-in</code> sets the input file as <fn> contig2.fasta</fn></li>
<li><code>-dbtype nucl</code> sets the type to nucleotide (rather than protein)</li>
</ul>
<p>Blast the start of the assembly (.head file) against all of the assembly: </p>
<div class="codehilite"><pre><span></span><code>blastn -query contig2.fa.head -db contig2.fasta -evalue 1e-3 -dust no -out contig2.bls
</code></pre></div>

<ul>
<li><code>blastn</code> is the tool Blast, set as blast<strong>n</strong> to compare sequences of nucleotides to each other</li>
<li><code>-query</code> sets the input sequence as <fn>contig2.fa.head</fn></li>
<li><code>-db</code> sets the database as that of the original sequence <fn>contig2.fasta</fn>. We don&rsquo;t have to specify the other files that were created when we formatted this file, but they need to present in our current directory. </li>
<li><code>-evalue</code> is the number of hits expected by chance, here set as 1e-3</li>
<li><code>-dust no</code> turns off the masking of low-complexity regions</li>
<li><code>-out</code> sets the output file as <fn>contig2.bls</fn></li>
</ul>
<p>Look at the hits (the matches): </p>
<div class="codehilite"><pre><span></span><code>less contig2.bls
</code></pre></div>

<ul>
<li>The first hit is at the start, as expected. We can see that &ldquo;Query 1&rdquo; (the start of the contig) is aligned to &ldquo;Sbject 1&rdquo; (the whole contig), for the first 540 bases.</li>
<li>Scroll down with the down arrow. </li>
<li>The second hit shows &ldquo;Query 1&rdquo; (the start of the contig) also matches to &ldquo;Sbject 1&rdquo; (the whole contig) at position 2253, all the way to the end, position 2359. </li>
</ul>
<p><img alt="blast" src="images/blasthits.png" /></p>
<ul>
<li>This is the overhang.</li>
<li>Therefore, in the next step, we need to trim the contig to position 2252.</li>
<li>Type <code>q</code> to exit. </li>
</ul>
<p>First, change the name of the contig within the file:</p>
<div class="codehilite"><pre><span></span><code>nano contig2.fasta
</code></pre></div>

<ul>
<li><code>nano</code> opens up a text editor. </li>
<li>Use the arrow keys to navigate. (The mouse won&rsquo;t work.)</li>
<li>At the first line, delete the text, which will be something like &ldquo;&gt;NODE_1_length_2359_cov_3.320333&rdquo;</li>
<li>Type in &ldquo;&gt;contig2&rdquo; </li>
<li>Don&rsquo;t forget the <code>&gt;</code> symbol</li>
<li>Press Control-X</li>
<li>&ldquo;Save modified buffer ?&rdquo; - type <code>Y</code></li>
<li>Press the Enter key</li>
</ul>
<p>Index the file (this will allow samtools to edit the file as it will have an index): </p>
<div class="codehilite"><pre><span></span><code><span class="n">samtools</span><span class="w"> </span><span class="n">faidx</span><span class="w"> </span><span class="n">contig2</span><span class="o">.</span><span class="n">fasta</span>
</code></pre></div>

<ul>
<li><code>faidx</code> means index the fasta file</li>
</ul>
<p>Trim the contig:</p>
<div class="codehilite"><pre><span></span><code><span class="n">samtools</span><span class="w"> </span><span class="n">faidx</span><span class="w"> </span><span class="n">contig2</span><span class="o">.</span><span class="n">fasta</span><span class="w"> </span><span class="n">contig2</span><span class="p">:</span><span class="mi">1</span><span class="o">-</span><span class="mi">2252</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">plasmid</span><span class="o">.</span><span class="n">fasta</span>
</code></pre></div>

<ul>
<li>this extracts contig2 from position 1-2252</li>
<li>
<p><code>&gt; plasmid.fasta</code> sends the extracted section to a new file</p>
</li>
<li>
<p>We now have a trimmed plasmid.</p>
</li>
</ul>
<p>Copy the plasmid file into the main folder: </p>
<div class="codehilite"><pre><span></span><code>cp plasmid.fasta ../
</code></pre></div>

<p>Move file back into main folder: </p>
<div class="codehilite"><pre><span></span><code>cd ..
</code></pre></div>

<h3 id="collect-contigs">Collect contigs</h3>
<p>Collect the chromosome and the plasmid in one fasta file (they will be 2 records in the file): </p>
<div class="codehilite"><pre><span></span><code>cat contig1.fasta plasmid.fasta &gt; genome.fasta
</code></pre></div>

<p>See the contigs and sizes:</p>
<div class="codehilite"><pre><span></span><code>infoseq genome.fasta
</code></pre></div>

<ul>
<li>chromosome: 30019</li>
<li>plasmid: 2252</li>
</ul>
<h3 id="questions_2">Questions</h3>
<div class="admonition note">
<p class="admonition-title">Question</p>
<p>Why is this section so complicated?</p>
<details>
<summary>Answer</summary>
<p>Finding small plasmids is difficult for many reasons! This paper has a nice summary: On the (im)possibility to reconstruct plasmids from whole genome short-read sequencing data. doi: https://doi.org/10.1101/086744</p>
</details>
</div>
<div class="admonition note">
<p class="admonition-title">Question</p>
<p>Why can PacBio sequencing miss small plasmids?</p>
<details>
<summary>Answer</summary>
<p>Library prep size selection.</p>
</details>
</div>
<div class="admonition note">
<p class="admonition-title">Question</p>
<p>We extract unmapped Illumina reads and assemble these to find small plasmids. What could they be missing?</p>
<details>
<summary>Answer</summary>
<p>Repeats that have mapped to the PacBio assembly.</p>
</details>
</div>
<div class="admonition note">
<p class="admonition-title">Question</p>
<p>How do you find a plasmid in a Bandage graph?</p>
<details>
<summary>Answer</summary>
<p>It is probably circular, matches the size of a known plasmid, and has a rep gene.</p>
</details>
</div>
<div class="admonition note">
<p class="admonition-title">Question</p>
<p>Are there easier ways to find plasmids?</p>
<details>
<summary>Answer</summary>
<p>Possibly. One option is the program called Unicycler which may automate many of these steps. https://github.com/rrwick/Unicycler</p>
</details>
</div>
<h2 id="7-correct-the-assembly">7. Correct the assembly</h2>
<p>Sequences from PacBio can have more errors than those from Illumina. Therefore, although it is useful to use the long PacBio reads to assemble the genome, we can also use the shorter and more accurate Illumina reads to correct errors in the PacBio assembly. </p>
<h3 id="make-an-alignment-file">Make an alignment file</h3>
<p>Index the fasta file:</p>
<div class="codehilite"><pre><span></span><code>bwa index genome.fasta
</code></pre></div>

<p>Align the Illumina reads:</p>
<div class="codehilite"><pre><span></span><code>bwa mem -t 4 genome.fasta R1.fq R2.fq | samtools sort &gt; pilon_aln.bam
</code></pre></div>

<ul>
<li>Aligns Illumina <fn>R1.fq</fn> and <fn>R2.fq</fn> to the PacBio assembly <fn>genome.fasta</fn>. </li>
<li>This produces a .bam file</li>
<li><code>|</code> pipes the output to samtools to sort (required for downstream processing)</li>
<li><code>&gt; pilon_aln.bam</code> redirects the sorted bam to this file</li>
</ul>
<p>Index the files:</p>
<div class="codehilite"><pre><span></span><code>samtools index pilon_aln.bam
</code></pre></div>

<div class="codehilite"><pre><span></span><code>samtools faidx genome.fasta
</code></pre></div>

<ul>
<li>Now we have an alignment file to use  with the tool <a href="https://github.com/broadinstitute/pilon/wiki">Pilon</a>: <fn>pilon_aln.bam</fn></li>
</ul>
<h3 id="run-pilon">Run Pilon</h3>
<p>Run:</p>
<div class="codehilite"><pre><span></span><code>pilon --genome genome.fasta --frags pilon_aln.bam --output pilon1 --fix all --mindepth 0.5 --changes --verbose --threads 4
</code></pre></div>

<ul>
<li><code>--genome</code> is the name of the input assembly to be corrected</li>
<li><code>--frags</code> is the alignment of the reads against the assembly</li>
<li><code>--output</code> is the name of the output prefix</li>
<li><code>--fix</code> is an option for types of corrections</li>
<li><code>--mindepth</code> gives a minimum read depth to use</li>
<li><code>--changes</code> produces an output file of the changes made</li>
<li><code>--verbose</code> prints information to the screen during the run</li>
<li><code>--threads</code>: number of cores</li>
</ul>
<p>Look at the changes file: </p>
<div class="codehilite"><pre><span></span><code>less pilon1.changes
</code></pre></div>

<p><em>Example:</em></p>
<p><img alt="pilon" src="images/pilon.png" /></p>
<ul>
<li>We can see lots of cases where a deletion (represented by a dot) has been corrected to a base.  </li>
<li>Type <code>q</code> to exit. </li>
</ul>
<p>Look at the details of the fasta file: </p>
<div class="codehilite"><pre><span></span><code>infoseq pilon1.fasta
</code></pre></div>

<ul>
<li>chromosome - 30060 (net +41 bases)</li>
<li>plasmid - 2252 (no change)</li>
</ul>
<p>Change the file name: </p>
<div class="codehilite"><pre><span></span><code>cp pilon1.fasta assembly.fasta
</code></pre></div>

<p>We now have the corrected genome assembly of <em>Staphylococcus aureus</em> in .fasta format, containing a chromosome and a small plasmid.  </p>
<h3 id="questions_3">Questions</h3>
<div class="admonition note">
<p class="admonition-title">Question</p>
<p>Why don&rsquo;t we correct earlier in the assembly process?</p>
<details>
<summary>Answer</summary>
<p>We need to circularise the contigs and trim overhangs first.</p>
</details>
</div>
<div class="admonition note">
<p class="admonition-title">Question</p>
<p>Why can we use some reads (Illumina) to correct other reads (PacBio) ?</p>
<details>
<summary>Answer</summary>
<p>Illumina reads have higher accuracy.</p>
</details>
</div>
<div class="admonition note">
<p class="admonition-title">Question</p>
<p>Could we just use PacBio reads to assemble the genome?</p>
<details>
<summary>Answer</summary>
<p>Yes, if accuracy adequate.</p>
</details>
</div>
<h2 id="8-comparative-genomics">8. Comparative Genomics</h2>
<p>In the workshop so far, we used a partial bacterial genome so that the exercises could run in the time available. As a demonstration, to better see the effect of long and short reads on the assembly, we will examine complete bacterial genome. </p>
<h3 id="assemblies">Assemblies</h3>
<p>This bacterial genome has been assembled from either long PacBio reads (using Canu) or shorter Illumina reads (using Spades). </p>
<p>Assembly graphs:</p>
<p>Look at the assembly graph (usually has a suffix .gfa), in the program <a href="https://rrwick.github.io/Bandage/">Bandage</a>. This shows how contigs are related, albeit with ambiguity in some places.</p>
<p>The assembly graph from Illumina reads (Spades assembly):</p>
<p><img alt="spades assembly graph" src="images/25747_spades_illumina_graph.png" /></p>
<p>The assembly graph from PacBio reads (Canu assembly) - this is missing the small plasmid:</p>
<p><img alt="canu assembly graph" src="images/25747_canu_pacbio_graph.png" /></p>
<p>Here we can see that the long read data results in a more contiguous assembly - one complete chromosome versus many smaller contigs with ambiguous placement. </p>
<div class="admonition note">
<p class="admonition-title">Question</p>
<p>Does it matter that an assembly is in many contigs?</p>
<details>
<summary>Answer</summary>
<p>Yes and No. Yes: broken genes can lead to missing/incorrect annotations; fragmented assemblies provide less information about the genomic structure (<em>e.g.</em> the number of plasmids) and the location of genes of interest (<em>e.g.</em> gene A is located on plasmid X). No: many or all genes may still be annotated correctly. Gene location is useful (e.g. chromosome, plasmid1) but not always essential (e.g. presence/absence of particular resistance genes may be enough information).</p>
</details>
</div>
<h3 id="annotations">Annotations</h3>
<p>Genomic features such as genes can be identified with annotation tools. We have used a tool called <a href="https://github.com/tseemann/prokka">Prokka</a> to annotate the two genomes described above. </p>
<p>Some of the output data is displayed here:</p>
<p><center></p>
<table>
<thead>
<tr>
<th>assembly:</th>
<th style="text-align: right;">PacBio</th>
<th style="text-align: right;">Illumina</th>
</tr>
</thead>
<tbody>
<tr>
<td>size</td>
<td style="text-align: right;">2,825,804</td>
<td style="text-align: right;">2,792,905</td>
</tr>
<tr>
<td>contigs</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">123</td>
</tr>
<tr>
<td>CDS</td>
<td style="text-align: right;">2614</td>
<td style="text-align: right;">2575</td>
</tr>
<tr>
<td>tRNA</td>
<td style="text-align: right;">61</td>
<td style="text-align: right;">65</td>
</tr>
<tr>
<td>rRNA</td>
<td style="text-align: right;">19</td>
<td style="text-align: right;">4</td>
</tr>
</tbody>
</table>
<p></center></p>
<div class="admonition note">
<p class="admonition-title">Question</p>
<p>Why are there more CDS identified in the PacBio assembly? </p>
<details>
<summary>Answer</summary>
<p>The PacBio assembly may have errors (usually a one base indel) which will cause a frame shift, which can result in three things: a longer CDS, a shorter CDS, or a shorter CDS plus an additional CDS. In addition, the Illumina assembly is about 33 kb smaller than the PacBio assembly. In bacteria, a rule of thumb is that 1 kb is roughly equal to one gene. Thus, we would probably expect about 33 fewer identified genes, which fits with these results.  </p>
</details>
</div>
<div class="admonition note">
<p class="admonition-title">Question</p>
<p>Why are there more rRNA identified in the PacBio assembly? </p>
<details>
<summary>Answer</summary>
<p>There may be multiple copies of the rRNAs and these could have been collapsed as repeats in the Illumina assembly. </p>
</details>
</div>
<h2 id="9-summary">9. Summary</h2>
<p>In this workshop, we used bacterial sequencing data from long and short reads to produce a polished genome. </p>
<p>Procedure and tools: </p>
<ul>
<li>Canu to assemble long-read PacBio data</li>
<li>Circlator to trim and circularise contigs</li>
<li>BWA-MEM to map shorter Illumina reads to the PacBio assembly</li>
<li>Spades to assemble any unmapped, leftover Illumina reads (the plasmid)</li>
<li>Pilon to correct the PacBio assembly with the more accurate Illumina reads</li>
</ul>
<p>We also looked at comparative genomics:</p>
<ul>
<li>Bandage to examine assembly graphs</li>
<li>Prokka to annotate genomes with features such as genes</li>
</ul>
<p>Further research:</p>
<ul>
<li>Align genomes with Mauve: <a href="http://sepsis-omics.github.io/tutorials/modules/mauve/">tutorial link</a></li>
<li>Find core and pan genomes with Roary and Phandango: <a href="http://sepsis-omics.github.io/tutorials/modules/roary/">tutorial link</a></li>
</ul>
<p>Melbourne Bioinformatics tutorials:</p>
<ul>
<li>https://www.melbournebioinformatics.org.au/tutorials/</li>
</ul>
<p>Additional microbial genomics tutorials:</p>
<ul>
<li>http://sepsis-omics.github.io/tutorials/</li>
</ul>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      &copy; The authors; 2016-
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": [], "search": "../../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.ad660dcc.min.js"></script>
      
    
  </body>
</html>